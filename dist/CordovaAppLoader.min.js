var CordovaAppLoader=function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){function o(e){if(!e)throw new Error("CordovaAppLoader has no options!");if(!e.fs)throw new Error('CordovaAppLoader has no "fs" option (cordova-promise-fs)');if(!e.serverRoot)throw new Error('CordovaAppLoader has no "serverRoot" option.');if(!window.pegasus||!window.Manifest)throw new Error("CordovaAppLoader bootstrap.js is missing.");this.allowServerRootFromManifest=e.allowServerRootFromManifest===!0,s=e.fs.Promise,this.manifest=window.Manifest,this.newManifest=null,this.bundledManifest=null,this.bundledFS=null,this._lastUpdateFiles=localStorage.getItem("last_update_files"),e.serverRoot=e.serverRoot||"",e.serverRoot&&"/"!==e.serverRoot[e.serverRoot.length-1]&&(e.serverRoot+="/"),this.newManifestUrl=e.manifestUrl||e.serverRoot+(e.manifest||"manifest.json"),e.mode&&(e.mode="mirror"),this.cache=new r(e),this.corruptNewManifest=!1,this._toBeCopied=[],this._toBeDeleted=[],this._toBeDownloaded=[],this._updateReady=!1,this._checkTimeout=e.checkTimeout||1e4}var r=n(2),i=n(1),s=null,a=8,u="www/";o.prototype._createFilemap=function(e){var t={},n=this.cache._fs.normalize;return Object.keys(e).forEach(function(o){e[o].filename=n(e[o].filename),t[e[o].filename]=e[o]}),t},o.prototype.getBundledManifest=function(){var e=this,t=document.querySelector("script[manifest]"),n=(t?t.getAttribute("manifest"):null)||"manifest.json";return new s(function(t,o){e.bundledManifest?t(e.bundledManifest):(pegasus(n).then(function(n){e.bundledManifest=n,t(n)},o),setTimeout(function(){o(new Error("bundled manifest timeout"))},e._checkTimeout))})},o.prototype.getBundledFS=function(){return self.bundledFS||(self.bundledFS=i({fileSystem:a})),self.bundledFS},o.prototype.copyFromBundle=function(e){var t=this;return new s(function(n,o){var r=t.getBundledFS(),i=t.cache._fs,a=i.dirname(t.cache.localRoot+e),c=u+e,f=i.filename(e);return s.all([r.file(c),i.ensure(a)]).then(function(e){var t=e[0],r=e[1];t.copyTo(r,f,n,o)},o)})},o.prototype.check=function(e){var t=this,n=this.manifest;"string"==typeof e&&(t.newManifestUrl=e,e=void 0);var o=new s(function(n,o){"object"==typeof e?n(e):(console.log("checking new manifest:",t.newManifestUrl),pegasus(t.newManifestUrl).then(n,o),setTimeout(function(){o(new Error("new manifest timeout"))},t._checkTimeout))});return new s(function(e,r){s.all([o,t.getBundledManifest(),t.cache.list()]).then(function(o){var i=o[0],s=o[1];if(JSON.stringify(i.files)===t._lastUpdateFiles)return JSON.stringify(i.files)!==JSON.stringify(Manifest.files)&&(console.warn("New manifest available, but an earlier update attempt failed. Will not download."),t.corruptNewManifest=!0,e(null)),void e(!1);if(!i.files)return void r('Downloaded Manifest has no "files" attribute.');var a=o[2],u=t._createFilemap(n.files),c=t._createFilemap(i.files),f=t._createFilemap(s.files);t._toBeDownloaded=[],t._toBeCopied=[],t._toBeDeleted=[];var l=t.cache._fs.isCordova;Object.keys(c).filter(function(e){return!u[e]||u[e].version!==c[e].version||!t.cache.isCached(e)}).forEach(function(e){l&&f[e]&&f[e].version===c[e].version?t._toBeCopied.push(e):t._toBeDownloaded.push(e)}),t._toBeDeleted=a.map(function(e){return e.substr(t.cache.localRoot.length)}).filter(function(e){return!c[e]||t._toBeDownloaded.indexOf(e)>=0||t._toBeCopied.indexOf(e)>=0});var d=t._toBeDeleted.length+t._toBeDownloaded.length;d>0?(t.newManifest=i,t.newManifest.root=t.cache.localInternalURL,e(!0)):e(!1)})})},o.prototype.canDownload=function(){return!!this.newManifest&&!this._updateReady},o.prototype.canUpdate=function(){return this._updateReady},o.prototype.download=function(e){var t=this;return t.canDownload()?(localStorage.removeItem("manifest"),localStorage.setItem("last_update_files",JSON.stringify(this.newManifest.files)),this.manifest.files=Manifest.files={},t.cache.remove(t._toBeDeleted,!0).then(function(){return s.all(t._toBeCopied.map(t.copyFromBundle.bind(t)))}).then(function(){return t.allowServerRootFromManifest&&t.newManifest.serverRoot&&(t.cache.serverRoot=t.newManifest.serverRoot),t.cache.add(t._toBeDownloaded),t.cache.download(e)}).then(function(){return t._toBeDeleted=[],t._toBeDownloaded=[],t._updateReady=!0,t.newManifest},function(e){return e&&e.length&&t.cache.remove(e),e})):s.resolve(null)},o.prototype.update=function(e){return this._updateReady?(localStorage.setItem("manifest",JSON.stringify(this.newManifest)),e!==!1&&location.reload(),!0):!1},o.prototype.clear=function(){return localStorage.removeItem("last_update_files"),localStorage.removeItem("manifest"),this.cache.clear()},o.prototype.reset=function(){return this.clear().then(function(){location.reload()},function(){location.reload()})},e.exports=o},function(e){function t(e,n,o,r){e.getDirectory(n[0],{create:!0},function(e){n.length>1?t(e,n.slice(1),o,r):o(e)},r)}function n(e){return e=e.substr(0,e.lastIndexOf("/")+1),"/"===e[0]&&(e=e.substr(1)),e}function o(e){return e.substr(e.lastIndexOf("/")+1)}function r(e){return e=e||"","/"===e[0]&&(e=e.substr(1)),e&&e.indexOf(".")<0&&"/"!==e[e.length-1]&&(e+="/"),"./"===e&&(e=""),e}var i=[],s=0;e.exports=function(e){function a(e){return new M(function(t){return t(e)})}function u(e){return new M(function(n,o){return C.then(function(r){e?(e=e.split("/").filter(function(e){return e&&e.length>0&&"."!==e[0]}),t(r.root,e,n,o)):n(r.root)},o)})}function c(e,t){return new M(function(n,o){return e instanceof FileEntry?n(e):(e=r(e),t=t||{},C.then(function(r){r.root.getFile(e,t,n,o)},o))})}function f(e,t){return e=r(e),t=t||{},new M(function(n,o){return C.then(function(r){e&&"/"!==e?r.root.getDirectory(e,t,n,o):n(r.root)},o)})}function l(e,t){t=t||"";var n=t.indexOf("r")>-1,o=t.indexOf("e")>-1,r=t.indexOf("f")>-1,i=t.indexOf("d")>-1;return r&&i&&(r=!1,i=!1),new M(function(t,s){return f(e).then(function(e){var u=e.createReader();u.readEntries(function(e){var u=[a(e)];n&&e.filter(function(e){return e.isDirectory}).forEach(function(e){u.push(l(e.fullPath,"re"))}),M.all(u).then(function(e){var n=[];n=n.concat.apply(n,e),r&&(n=n.filter(function(e){return e.isFile})),i&&(n=n.filter(function(e){return e.isDirectory})),o||(n=n.map(function(e){return e.fullPath})),t(n)},s)},s)},s)})}function d(e){return new M(function(t,n){c(e).then(function(e){t(e)},function(e){1===e.code?t(!1):n(e)})})}function h(e){return u(n(e)).then(function(){return c(e,{create:!0})})}function p(e){return c(e).then(function(e){return e.toURL()})}function w(e,t){return t=t||"readAsText",c(e).then(function(e){return new M(function(n,o){e.file(function(e){var o=new FileReader;o.onloadend=function(){n(this.result)},o[t](e)},o)})})}function v(e){return w(e,"readAsDataURL")}function y(e){return w(e).then(JSON.parse)}function m(e,t,o){return u(n(e)).then(function(){return c(e,{create:!0})}).then(function(e){return new M(function(n,r){e.createWriter(function(e){e.onwriteend=n,e.onerror=r,"string"==typeof t?t=new Blob([t],{type:o||"text/plain"}):t instanceof Blob!=!0&&(t=new Blob([JSON.stringify(t,null,4)],{type:o||"application/json"})),e.write(t)},r)})})}function _(e,t){return u(n(t)).then(function(n){return c(e).then(function(e){return new M(function(r,i){e.moveTo(n,o(t),r,i)})})})}function g(e,t){return u(n(t)).then(function(n){return c(e).then(function(e){return new M(function(r,i){e.copyTo(n,o(t),r,i)})})})}function R(e,t){var n=t?c:d;return new M(function(t,o){n(e).then(function(e){e!==!1?e.remove(t,o):t(1)},o)}).then(function(e){return 1===e?!1:!0})}function S(e){return f(e).then(function(e){return new M(function(t,n){e.removeRecursively(t,n)})})}function b(){for(;i.length>0&&s<e.concurrency;){s++;var t=i.pop(),n=t.shift(),o=t.shift(),r=t.shift(),a=t.shift(),u=t.shift(),c=t.shift(),f=t.shift(),l=t.shift();n._aborted?s--:o?(n.download.call(n,r,a,u,c,f,l),n.onprogress&&n.onprogress(new ProgressEvent)):n.upload.call(n,a,r,u,c,l,f)}}function U(e){return s--,b(),e}function D(t,n,o,r,a){"function"==typeof r&&(a=r,r={}),n=encodeURI(n),x&&(o=O(o)),r=r||{},r.retry&&r.retry.length||(r.retry=e.retry),r.retry=r.retry.concat();var u=new FileTransfer;a=a||r.onprogress,"function"==typeof a&&(u.onprogress=a);var c=new M(function(e,a){var c=function(s){if(0===r.retry.length)a(s);else{i.unshift([u,t,n,o,e,c,r.trustAllHosts||!1,r]);var f=r.retry.shift();f>0?setTimeout(U,f):U()}};r.retry.unshift(0),s++,c()});return c.then(U,U),c.progress=function(e){return u.onprogress=e,c},c.abort=function(){return u._aborted=!0,u.abort(),c},c}function L(e,t,n,o){return D(!0,e,t,n,o)}function F(e,t,n,o){return D(!1,t,e,n,o)}var M=e.Promise||window.Promise;if(!M)throw new Error("No Promise library given in options.Promise");this.options=e=e||{},e.persistent=void 0!==e.persistent?e.persistent:!0,e.storageSize=e.storageSize||20971520,e.concurrency=e.concurrency||3,e.retry=e.retry||[];var B,x="undefined"!=typeof cordova;x?B=new M(function(e,t){document.addEventListener("deviceready",e,!1),setTimeout(function(){t(new Error("deviceready has not fired after 5 seconds."))},5100)}):(B=a(!0),"undefined"!=typeof webkitRequestFileSystem?(window.requestFileSystem=webkitRequestFileSystem,window.FileTransfer=function(){},FileTransfer.prototype.download=function(e,t,n,o){var r=new XMLHttpRequest;return r.open("GET",e),r.responseType="blob",r.onreadystatechange=function(){4==r.readyState&&(200===r.status?m(t,r.response).then(n,o):o(r.status))},r.send(),r},window.ProgressEvent=function(){}):window.requestFileSystem=function(e,t,n,o){o(new Error("requestFileSystem not supported!"))});var C=new M(function(t,n){B.then(function(){var o=e.persistent?1:0;"number"==typeof e.fileSystem&&(o=e.fileSystem),!x&&o>1&&(console.warn('Chrome does not support fileSystem "'+o+'". Falling back on "0" (temporary).'),o=0),window.requestFileSystem(o,e.storageSize,t,n),setTimeout(function(){n(new Error("Could not retrieve FileSystem after 5 seconds."))},5100)},n)});C.then(function(e){window.__fs=e},function(e){console.error("Could not get Cordova FileSystem:",e)});var E,O;return x?(O=function(t){return t=r(t),"cdvfile://localhost/"+(e.persistent?"persistent/":"temporary/")+t},E=function(e){return c(e).then(function(e){return e.toInternalURL()})}):(O=function(t){return t=r(t),"filesystem:"+location.origin+(e.persistent?"/persistent/":"/temporary/")+t},E=function(e){return c(e).then(function(e){return e.toURL()})}),{fs:C,normalize:r,file:c,filename:o,dir:f,dirname:n,create:h,read:w,readJSON:y,write:m,move:_,copy:g,remove:R,removeDir:S,list:l,ensure:u,exists:d,download:L,upload:F,toURL:p,isCordova:x,toInternalURLSync:O,toInternalURL:E,toDataURL:v,deviceready:B,options:e,Promise:M}}},function(e,t,n){function o(e){var t=this;if(this._fs=e.fs,!this._fs)throw new Error('Missing required option "fs". Add an instance of cordova-promise-fs.');i=this._fs.Promise,this._mirrorMode="hash"!==e.mode,this._retry=e.retry||[500,1500,8e3],this._cacheBuster=!!e.cacheBuster,this.localRoot=this._fs.normalize(e.localRoot||"data"),this.serverRoot=this._fs.normalize(e.serverRoot||""),this._downloading=[],this._added=[],this._cached={},this.ready=this._fs.ensure(this.localRoot).then(function(e){return t.localInternalURL=s?e.toInternalURL():e.toURL(),t.localUrl=e.toURL(),t.list()})}var r=n(3),i=null,s="undefined"!=typeof cordova;o.prototype.list=function(){var e=this;return new i(function(t){e._fs.list(e.localRoot,"rfe").then(function(n){e._cached={},n=n.map(function(t){var n=e._fs.normalize(t.fullPath);return e._cached[n]={toInternalURL:s?t.toInternalURL():t.toURL(),toURL:t.toURL()},n}),t(n)},function(){t([])})})},o.prototype.add=function(e){e||(e=[]),"string"==typeof e&&(e=[e]);var t=this;return e.forEach(function(e){e=t.toServerURL(e),-1===t._added.indexOf(e)&&t._added.push(e)}),t.isDirty()},o.prototype.remove=function(e,t){e||(e=[]);var n=[];"string"==typeof e&&(e=[e]);var o=this;return e.forEach(function(e){var t=o._added.indexOf(o.toServerURL(e));t>=0&&o._added.splice(t,1);var r=o.toPath(e);n.push(o._fs.remove(r)),delete o._cached[r]}),t?i.all(n):o.isDirty()},o.prototype.getDownloadQueue=function(){var e=this,t=e._added.filter(function(t){return!e.isCached(t)});return t},o.prototype.getAdded=function(){return this._added},o.prototype.isDirty=function(){return this.getDownloadQueue().length>0},o.prototype.download=function(e){var t=this._fs,n=this;return n.abort(),new i(function(o,r){t.ensure(n.localRoot).then(function(){return n.list()}).then(function(){if(!n.isDirty())return void o(n);var i=n.getDownloadQueue(),s=[],a=n._downloading.length,u=n._downloading.length,c=n._downloading.length+i.length;i.forEach(function(i){var f,l=n.toPath(i);"function"==typeof e&&(f=function(t){t.queueIndex=a,t.queueSize=c,t.url=i,t.path=l,t.percentage=a/c,t.loaded>0&&t.total>0&&a!==c&&(t.percentage+=t.loaded/t.total/c),s.indexOf(i)<0&&(s.push(i),a++),e(t)});var d=function(){u++,u===c&&(n._downloading=[],n.list().then(function(){f&&f(new ProgressEvent),n.isDirty()?r(n.getDownloadQueue()):o(n)},r))},h=i;n._cacheBuster&&(h+="?"+Date.now());var p=t.download(h,l,{retry:n._retry},f);p.then(d,d),n._downloading.push(p)})},r)})},o.prototype.abort=function(){this._downloading.forEach(function(e){e.abort()}),this._downloading=[]},o.prototype.isCached=function(e){return e=this.toPath(e),!!this._cached[e]},o.prototype.clear=function(){var e=this;return this._cached={},this._fs.removeDir(this.localRoot).then(function(){return e._fs.ensure(e.localRoot)})},o.prototype.toInternalURL=function(e){return path=this.toPath(e),this._cached[path]?this._cached[path].toInternalURL:e},o.prototype.get=function(e){return path=this.toPath(e),this._cached[path]?this._cached[path].toInternalURL:this.toServerURL(e)},o.prototype.toDataURL=function(e){return this._fs.toDataURL(this.toPath(e))},o.prototype.toURL=function(e){return path=this.toPath(e),this._cached[path]?this._cached[path].toURL:e},o.prototype.toServerURL=function(e){return e=this._fs.normalize(e),e.indexOf("://")<0?this.serverRoot+e:e},o.prototype.toPath=function(e){return this._mirrorMode?(e=e=this._fs.normalize(e||""),len=this.serverRoot.length,e.substr(0,len)!==this.serverRoot?this.localRoot+e:this.localRoot+e.substr(len)):this.localRoot+r(e)+e.substr(e.lastIndexOf("."))},e.exports=o},function(e){function t(e,t){var n,o,r,i,s,a,u,c;for(n=3&e.length,o=e.length-n,r=t,s=3432918353,a=461845907,c=0;o>c;)u=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,u=(65535&u)*s+(((u>>>16)*s&65535)<<16)&4294967295,u=u<<15|u>>>17,u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295,r^=u,r=r<<13|r>>>19,i=5*(65535&r)+((5*(r>>>16)&65535)<<16)&4294967295,r=(65535&i)+27492+(((i>>>16)+58964&65535)<<16);switch(u=0,n){case 3:u^=(255&e.charCodeAt(c+2))<<16;case 2:u^=(255&e.charCodeAt(c+1))<<8;case 1:u^=255&e.charCodeAt(c),u=(65535&u)*s+(((u>>>16)*s&65535)<<16)&4294967295,u=u<<15|u>>>17,u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295,r^=u}return r^=e.length,r^=r>>>16,r=2246822507*(65535&r)+((2246822507*(r>>>16)&65535)<<16)&4294967295,r^=r>>>13,r=3266489909*(65535&r)+((3266489909*(r>>>16)&65535)<<16)&4294967295,r^=r>>>16,r>>>0}e.exports=t}]);